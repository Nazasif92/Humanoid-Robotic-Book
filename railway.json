{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "DOCKERFILE",
    "dockerfile": "backend/Dockerfile"
  },
  "deploy": {
    "startCommand": "uvicorn app.main:app --host 0.0.0.0 --port $PORT",
    "restartPolicyType": "on_failure",
    "restartPolicyMaxRetries": 5,
    "healthchecks": {
      "liveness": {
        "enabled": true,
        "initialDelaySeconds": 10,
        "intervalSeconds": 30,
        "timeoutSeconds": 10,
        "successThreshold": 1,
        "failureThreshold": 3
      }
    },
    "numReplicas": 1
  },
  "variables": {
    "BACKEND_PORT": {
      "description": "Backend server port",
      "default": "8000"
    },
    "LOG_LEVEL": {
      "description": "Application log level",
      "default": "INFO"
    },
    "INGESTION_BATCH_SIZE": {
      "description": "Batch size for parallel embedding",
      "default": "100"
    },
    "RAG_TOP_K": {
      "description": "Number of chunks to retrieve",
      "default": "3"
    }
  },
  "plugins": [
    {
      "source": "${{ plugin.railway.psql }}",
      "config": {
        "NEON_CONNECTION_STRING": "${{ NEON_CONNECTION_STRING }}"
      }
    }
  ]
}
